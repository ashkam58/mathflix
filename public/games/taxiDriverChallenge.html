<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Driver City Challenge</title>

    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Roboto+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #1e293b;
        }

        .font-display {
            font-family: 'Bungee', cursive;
        }

        .taxi-move {
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .grid-bg {
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 10% 10%;
            /* Matches 10x10 grid */
        }

        .building-shadow {
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.3);
        }

        @keyframes bounce-slow {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .animate-bounce-slow {
            animation: bounce-slow 1.5s infinite;
        }
    </style>
</head>

<body>

    <div id="root"></div>

    <script type="text/babel">

        const { useState, useEffect, useCallback } = React;

        // --- Icons (Inline SVGs) ---

        const TaxiIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" className="w-full h-full drop-shadow-md">
                <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" stroke="#facc15" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" fill="#facc15" />
                <path d="M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" stroke="#000" strokeWidth="2" fill="#333" />
                <path d="M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" stroke="#000" strokeWidth="2" fill="#333" />
                <line x1="5" y1="13" x2="19" y2="13" stroke="#eab308" strokeWidth="1" />
                <path d="M6 10h10l-1.5-3h-7z" fill="#000" opacity="0.2" />
            </svg>
        );

        const PassengerIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" className="w-full h-full animate-bounce-slow">
                <circle cx="12" cy="8" r="4" fill="#60a5fa" stroke="#2563eb" strokeWidth="1.5" />
                <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" fill="#60a5fa" stroke="#2563eb" strokeWidth="1.5" />
            </svg>
        );

        const FlagIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" className="w-full h-full animate-pulse">
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" fill="#4ade80" stroke="#16a34a" strokeWidth="1.5" />
                <line x1="4" y1="22" x2="4" y2="15" stroke="#888" strokeWidth="2" />
            </svg>
        );

        const BuildingIcon = ({ type }) => {
            // Simple decorative buildings
            const colors = ["#cbd5e1", "#94a3b8", "#64748b"];
            const color = colors[type % colors.length];
            return (
                <svg viewBox="0 0 24 24" fill="none" className="w-full h-full opacity-30">
                    <rect x="4" y="8" width="16" height="16" rx="1" fill={color} />
                    <rect x="7" y="11" width="3" height="3" fill="#e2e8f0" />
                    <rect x="14" y="11" width="3" height="3" fill="#e2e8f0" />
                    <rect x="7" y="16" width="3" height="3" fill="#e2e8f0" />
                    <rect x="14" y="16" width="3" height="3" fill="#e2e8f0" />
                </svg>
            );
        };

        // --- Game Data & Logic ---

        const GRID_SIZE = 10;

        const LEVELS = [
            { id: 1, pickup: { x: 2, y: 3 }, dropoff: { x: 6, y: 3 }, start: { x: 0, y: 0 }, desc: "Pick up Mr. Smith at (2,3) and take him East to the Bank at (6,3)." },
            { id: 2, pickup: { x: 5, y: 5 }, dropoff: { x: 5, y: 9 }, start: { x: 6, y: 3 }, desc: "Grab lunch at the Burger Joint (5,5) and deliver it North to (5,9)." },
            { id: 3, pickup: { x: 8, y: 1 }, dropoff: { x: 1, y: 8 }, start: { x: 5, y: 9 }, desc: "Long haul! Passenger at (8,1) needs to go to the Airport at (1,8)." },
            { id: 4, pickup: { x: 3, y: 6 }, dropoff: { x: 9, y: 0 }, start: { x: 1, y: 8 }, desc: "Zig zag through the city from (3,6) to the Park at (9,0)." },
        ];

        const CityGrid = ({ taxiPos, targetPos, targetType, pathHistory, onMove }) => {
            // Convert Logical (0-10) to Percent for positioning
            const toPercent = (val) => `${(val / GRID_SIZE) * 100}%`;

            // Reverse Y for rendering (0 at bottom)
            const getBottom = (y) => `${(y / GRID_SIZE) * 100}%`;

            return (
                <div className="relative w-full aspect-square bg-slate-800 rounded-lg border-4 border-slate-600 shadow-2xl overflow-hidden grid-bg">

                    {/* Grid Coordinates Labels */}
                    <div className="absolute left-0 bottom-0 top-0 w-8 flex flex-col justify-between py-2 text-xs text-slate-500 font-bold items-center pointer-events-none z-0">
                        {Array.from({ length: 11 }).map((_, i) => <div key={`y${i}`}>{10 - i}</div>)}
                    </div>
                    <div className="absolute left-0 bottom-0 right-0 h-6 flex justify-between px-2 text-xs text-slate-500 font-bold items-center pointer-events-none z-0">
                        {Array.from({ length: 11 }).map((_, i) => <div key={`x${i}`} className="w-full text-center">{i}</div>)}
                    </div>

                    {/* Play Area (Inset to accommodate labels slightly if needed, but keeping full size for now) */}
                    <div className="absolute inset-0 z-10">

                        {/* Decorative Buildings (Static) */}
                        {[
                            { x: 1, y: 8, t: 0 }, { x: 8, y: 8, t: 1 },
                            { x: 2, y: 1, t: 2 }, { x: 8, y: 2, t: 0 },
                            { x: 5, y: 5, t: 1 }
                        ].map((b, i) => (
                            <div
                                key={i}
                                className="absolute w-[10%] h-[10%] transition-all duration-500"
                                style={{ left: toPercent(b.x), bottom: getBottom(b.y) }}
                            >
                                <BuildingIcon type={b.t} />
                            </div>
                        ))}

                        {/* Path Trail */}
                        {pathHistory.map((pos, i) => (
                            <div
                                key={i}
                                className="absolute w-[10%] h-[10%] flex items-center justify-center"
                                style={{ left: toPercent(pos.x), bottom: getBottom(pos.y) }}
                            >
                                <div className="w-2 h-2 bg-yellow-400/30 rounded-full"></div>
                            </div>
                        ))}

                        {/* Target (Passenger or Destination) */}
                        <div
                            className="absolute w-[10%] h-[10%] p-1 transition-all duration-300"
                            style={{ left: toPercent(targetPos.x), bottom: getBottom(targetPos.y) }}
                        >
                            {targetType === 'pickup' ? <PassengerIcon /> : <FlagIcon />}

                            {/* Coordinate Bubble */}
                            <div className="absolute -top-6 left-1/2 -translate-x-1/2 bg-white text-slate-900 text-[10px] font-bold px-1 rounded shadow whitespace-nowrap">
                                ({targetPos.x}, {targetPos.y})
                            </div>
                        </div>

                        {/* Taxi */}
                        <div
                            className="absolute w-[10%] h-[10%] p-0.5 taxi-move z-20"
                            style={{ left: toPercent(taxiPos.x), bottom: getBottom(taxiPos.y) }}
                        >
                            <TaxiIcon />
                        </div>

                    </div>
                </div>
            );
        };

        const Controls = ({ onMove }) => {
            const btnClass = "bg-slate-700 hover:bg-slate-600 active:bg-slate-800 text-white rounded-lg p-4 shadow-lg font-bold border-b-4 border-slate-900 active:border-b-0 active:translate-y-1 transition-all";

            return (
                <div className="grid grid-cols-3 gap-2 max-w-[180px] mx-auto">
                    <div></div>
                    <button className={btnClass} onClick={() => onMove(0, 1)}>N</button>
                    <div></div>
                    <button className={btnClass} onClick={() => onMove(-1, 0)}>W</button>
                    <div className="flex items-center justify-center text-slate-500 text-xs font-bold">MOVE</div>
                    <button className={btnClass} onClick={() => onMove(1, 0)}>E</button>
                    <div></div>
                    <button className={btnClass} onClick={() => onMove(0, -1)}>S</button>
                    <div></div>
                </div>
            );
        };

        const TaxiApp = () => {
            const [levelIdx, setLevelIdx] = useState(0);
            const [taxiPos, setTaxiPos] = useState({ x: 0, y: 0 });
            const [phase, setPhase] = useState('pickup'); // 'pickup' or 'dropoff'
            const [pathHistory, setPathHistory] = useState([]); // Array of {x,y}
            const [blocksDriven, setBlocksDriven] = useState(0);
            const [totalFare, setTotalFare] = useState(0);
            const [message, setMessage] = useState("Welcome, Driver! Start your shift.");
            const [gameState, setGameState] = useState('playing'); // playing, level_complete, game_complete

            const currentLevel = LEVELS[levelIdx];
            const targetPos = phase === 'pickup' ? currentLevel.pickup : currentLevel.dropoff;

            // Initialize Level
            useEffect(() => {
                setTaxiPos(currentLevel.start);
                setPhase('pickup');
                setPathHistory([currentLevel.start]);
                setBlocksDriven(0);
                setMessage(currentLevel.desc);
                setGameState('playing');
            }, [levelIdx]);

            // Keyboard controls
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (gameState !== 'playing') return;
                    switch (e.key) {
                        case 'ArrowUp': handleMove(0, 1); break;
                        case 'ArrowDown': handleMove(0, -1); break;
                        case 'ArrowLeft': handleMove(-1, 0); break;
                        case 'ArrowRight': handleMove(1, 0); break;
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [taxiPos, gameState]); // Dep on taxiPos to ensure latest state used in move check

            const handleMove = (dx, dy) => {
                if (gameState !== 'playing') return;

                const newX = taxiPos.x + dx;
                const newY = taxiPos.y + dy;

                // Boundary Check
                if (newX < 0 || newX > 10 || newY < 0 || newY > 10) return;

                // Update Position
                const newPos = { x: newX, y: newY };
                setTaxiPos(newPos);
                setPathHistory(prev => [...prev, newPos]);
                setBlocksDriven(prev => prev + 1);

                // Check Objective
                if (newX === targetPos.x && newY === targetPos.y) {
                    handleObjectiveReached();
                }
            };

            const handleObjectiveReached = () => {
                if (phase === 'pickup') {
                    setPhase('dropoff');
                    setMessage(`Passenger acquired! Drive to (${currentLevel.dropoff.x}, ${currentLevel.dropoff.y}).`);
                    // Reset blocks for the trip part? Or keep cumulative?
                    // Let's keep cumulative for the level to show "Total Blocks".
                } else {
                    // Dropoff Complete
                    const fare = blocksDriven * 2; // $2 per block
                    setTotalFare(prev => prev + fare);
                    setGameState('level_complete');
                    setMessage(`Trip Complete! You drove ${blocksDriven} blocks. Fare: $${fare}.`);
                }
            };

            const nextLevel = () => {
                if (levelIdx < LEVELS.length - 1) {
                    setLevelIdx(prev => prev + 1);
                } else {
                    setGameState('game_complete');
                    setMessage("Shift Over! You are the Top Taxi Driver!");
                }
            };

            return (
                <div className="min-h-screen p-4 flex flex-col items-center justify-center bg-slate-900 text-slate-100">

                    {/* Header / Dashboard */}
                    <div className="w-full max-w-lg mb-4 bg-slate-800 p-4 rounded-xl border-b-4 border-yellow-500 shadow-lg">
                        <div className="flex justify-between items-center mb-2">
                            <h1 className="font-display text-yellow-400 text-xl md:text-2xl uppercase tracking-wider">
                                City Taxi <span className="text-white text-sm font-mono block md:inline md:ml-2">Level {levelIdx + 1}</span>
                            </h1>
                            <div className="text-right">
                                <div className="text-xs text-slate-400 uppercase">Total Earnings</div>
                                <div className="font-mono text-green-400 font-bold text-xl">${totalFare}</div>
                            </div>
                        </div>

                        <div className="flex gap-4 bg-slate-900/50 p-3 rounded-lg font-mono text-sm">
                            <div className="flex-1">
                                <span className="text-slate-500 block text-xs uppercase">Current Location</span>
                                <span className="text-yellow-200 font-bold">({taxiPos.x}, {taxiPos.y})</span>
                            </div>
                            <div className="flex-1 border-l border-slate-700 pl-4">
                                <span className="text-slate-500 block text-xs uppercase">Trip Distance</span>
                                <span className="text-blue-300 font-bold">{blocksDriven} Blocks</span>
                            </div>
                        </div>

                        <div className="mt-2 bg-blue-900/30 border border-blue-500/30 p-2 rounded text-xs md:text-sm text-blue-200 text-center animate-pulse">
                            {message}
                        </div>
                    </div>

                    {/* Main Game Area */}
                    <div className="w-full max-w-lg relative">
                        <CityGrid
                            taxiPos={taxiPos}
                            targetPos={targetPos}
                            targetType={phase}
                            pathHistory={pathHistory}
                        />

                        {/* Level Complete Overlay */}
                        {gameState === 'level_complete' && (
                            <div className="absolute inset-0 bg-slate-900/90 z-30 flex flex-col items-center justify-center rounded-lg p-6 text-center">
                                <div className="text-4xl mb-2">üöñüí®</div>
                                <h2 className="font-display text-2xl text-green-400 mb-2">Ride Complete!</h2>
                                <p className="font-mono text-sm text-slate-300 mb-6">
                                    Blocks Driven: <span className="text-white font-bold">{blocksDriven}</span><br />
                                    Fare Earned: <span className="text-green-400 font-bold">${blocksDriven * 2}</span>
                                </p>
                                <button
                                    onClick={nextLevel}
                                    className="bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold py-3 px-8 rounded-full shadow-lg transition-transform hover:scale-105 font-display"
                                >
                                    Next Customer
                                </button>
                            </div>
                        )}

                        {/* Game Complete Overlay */}
                        {gameState === 'game_complete' && (
                            <div className="absolute inset-0 bg-slate-900/95 z-30 flex flex-col items-center justify-center rounded-lg p-6 text-center">
                                <div className="text-6xl mb-4">üèÜ</div>
                                <h2 className="font-display text-3xl text-yellow-400 mb-2">Shift Complete!</h2>
                                <p className="font-mono text-slate-300 mb-8">
                                    Total Earnings: <span className="text-green-400 font-bold text-xl">${totalFare}</span>
                                </p>
                                <button
                                    onClick={() => window.location.reload()}
                                    className="bg-white hover:bg-slate-200 text-slate-900 font-bold py-3 px-8 rounded-full shadow-lg transition-transform hover:scale-105 font-display"
                                >
                                    Play Again
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Controls (Mobile/Mouse) */}
                    <div className="mt-6 w-full max-w-xs">
                        <Controls onMove={handleMove} />
                        <p className="text-center text-slate-500 text-xs mt-4 font-mono">
                            Use Arrow Keys or Buttons to drive.
                            <br />Target: {phase === 'pickup' ? 'Blue Passenger' : 'Green Flag'}
                        </p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TaxiApp />);

    </script>
</body>

</html>