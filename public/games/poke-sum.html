<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poké-Sum Slider</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Icons (Replaced Lucide with Inline SVGs) ---
        const Play = ({ size = 24, fill = "none", className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
        );
        const Pause = ({ size = 24, fill = "none", className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
        );
        const SkipForward = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg>
        );
        const SkipBack = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></svg>
        );
        const RotateCcw = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M1 4v6h6"></path><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
        );
        const Zap = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
        );
        const Trophy = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M17 4v4a5 5 0 0 1-5 5h0a5 5 0 0 1-5-5V4"></path><path d="M7 3v4c0 1.6.85 3 2.13 3.82"></path><path d="M17 3v4c0 1.6-.85 3-2.13 3.82"></path></svg>
        );
        const Calculator = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>
        );
        const Info = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
        );

        // --- Theme Colors & Constants ---
        const THEME = {
            bg: "bg-gradient-to-br from-green-400 to-emerald-600",
            card: "bg-white/90 backdrop-blur-sm",
            primary: "text-blue-600",
            accent: "text-yellow-500",
            windowBorder: "border-yellow-400 ring-4 ring-yellow-300",
            pokeballRed: "bg-red-500",
            pokeballWhite: "bg-white",
        };

        // --- Logic: Trace Generation ---
        const generateTrace = (nums, k) => {
            const trace = [];
            let windowSum = 0;
            let maxSum = -Infinity;

            trace.push({
                type: 'INIT',
                i: -1,
                windowSum: 0,
                maxSum: -Infinity,
                message: "Welcome, Trainer! Let's find the strongest team of " + k + " Pokémon.",
                codeLine: 'init',
                activeIndices: [],
                windowRange: null
            });

            for (let i = 0; i < nums.length; i++) {
                // 1. Add new element
                windowSum += nums[i];

                trace.push({
                    type: 'ADD',
                    i,
                    val: nums[i],
                    windowSum,
                    maxSum,
                    message: `Encountered Pokémon at index ${i} (Power: ${nums[i]}). Adding to current team power.`,
                    codeLine: 'add',
                    activeIndices: [i], // Highlight the one being added
                    windowRange: [Math.max(0, i - k + 1), i], // Visual approximation of current grouping
                    highlightType: 'adding'
                });

                // 2. Check if window is full
                if (i >= k - 1) {
                    // Before update visualization
                    const potentialMax = Math.max(maxSum, windowSum);
                    const isNewRecord = potentialMax > maxSum;

                    // Update max logic in memory (to show the result of the line)
                    maxSum = potentialMax;

                    trace.push({
                        type: 'CHECK',
                        i,
                        windowSum,
                        maxSum,
                        message: `Team size is ${k}. Total Power: ${windowSum}. ${isNewRecord ? "It's a new record!" : "Not enough to beat the record."}`,
                        codeLine: 'check',
                        activeIndices: [],
                        windowRange: [i - k + 1, i], // The valid window
                        highlightType: isNewRecord ? 'record' : 'check'
                    });

                    // 3. Slide (Remove left)
                    const leftIndex = i - (k - 1);
                    const leftVal = nums[leftIndex];
                    windowSum -= leftVal;

                    trace.push({
                        type: 'SLIDE',
                        i,
                        windowSum, // This value is now prepared for next iteration
                        maxSum,
                        message: `Moving the window... Releasing the first Pokémon (Index ${leftIndex}) to make room.`,
                        codeLine: 'slide',
                        activeIndices: [leftIndex], // Highlight the one leaving
                        windowRange: [leftIndex, i],
                        highlightType: 'leaving'
                    });
                } else {
                    // Window not full yet
                    trace.push({
                        type: 'WAIT',
                        i,
                        windowSum,
                        maxSum,
                        message: `Team size is only ${i + 1}. We need ${k} to start recording stats.`,
                        codeLine: 'wait',
                        activeIndices: [],
                        windowRange: [0, i],
                        highlightType: 'neutral'
                    });
                }
            }

            trace.push({
                type: 'FINISH',
                i: nums.length,
                windowSum,
                maxSum,
                message: `Training Complete! The Maximum Power found was ${maxSum}.`,
                codeLine: 'done',
                activeIndices: [],
                windowRange: null,
                highlightType: 'finish'
            });

            return trace;
        };

        // --- Components ---

        const Pokeball = ({ value, index, state, k, total }) => {
            // Determine visual state based on the current trace step
            const isActive = state.activeIndices.includes(index);
            const inWindow = state.windowRange && index >= state.windowRange[0] && index <= state.windowRange[1];

            let animationClass = "";
            if (state.type === 'ADD' && isActive) animationClass = "animate-bounce";
            if (state.type === 'SLIDE' && isActive) animationClass = "opacity-50 scale-90 grayscale";
            if (state.type === 'CHECK' && inWindow && state.highlightType === 'record') animationClass = "ring-4 ring-yellow-400 scale-110 z-10";

            return (
                <div className={`relative flex flex-col items-center justify-center transition-all duration-500 ${animationClass} mx-1`}>
                    {/* Index Label */}
                    <span className="text-xs font-bold text-gray-600 mb-1">idx: {index}</span>

                    {/* The Pokeball */}
                    <div
                        className={`
              w-16 h-16 rounded-full border-4 border-gray-800 overflow-hidden relative shadow-xl flex items-center justify-center
              ${inWindow ? 'shadow-yellow-400/50' : ''}
              transition-colors duration-300
            `}
                    >
                        {/* Top Half */}
                        <div className="absolute top-0 w-full h-1/2 bg-red-500 border-b-4 border-gray-800"></div>
                        {/* Bottom Half */}
                        <div className="absolute bottom-0 w-full h-1/2 bg-white"></div>
                        {/* Center Button */}
                        <div className="absolute w-6 h-6 bg-white border-4 border-gray-800 rounded-full z-10"></div>

                        {/* Value Overlay */}
                        <span className="relative z-20 font-black text-lg text-gray-800 drop-shadow-md bg-white/80 px-1 rounded">
                            {value}
                        </span>
                    </div>
                </div>
            );
        };

        const CodeBlock = ({ activeLine }) => {
            const code = [
                { id: 'init', text: 'let windowSum = 0; let maxSum = -Infinity;' },
                { id: 'loop', text: 'for (let i = 0; i < nums.length; i++) {' },
                { id: 'add', text: '  windowSum += nums[i];' },
                { id: 'check', text: '  if (i >= k - 1) { maxSum = Math.max(maxSum, windowSum);' },
                { id: 'slide', text: '    windowSum -= nums[i - (k - 1)]; }' },
                { id: 'done', text: 'return maxSum;' }
            ];

            return (
                <div className="bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-sm shadow-inner overflow-hidden border-2 border-gray-700">
                    <div className="flex items-center gap-2 mb-2 border-b border-gray-700 pb-2">
                        <div className="w-3 h-3 rounded-full bg-red-500"></div>
                        <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div className="w-3 h-3 rounded-full bg-green-500"></div>
                        <span className="text-gray-400 text-xs ml-auto">algorithm.js</span>
                    </div>
                    {code.map((line) => (
                        <div
                            key={line.id}
                            className={`
                px-2 py-1 transition-colors duration-200
                ${(activeLine === line.id || (activeLine === 'wait' && line.id === 'check')) ? 'bg-yellow-500/20 border-l-4 border-yellow-500 text-yellow-200' : 'text-gray-400 border-l-4 border-transparent'}
              `}
                        >
                            {line.text}
                        </div>
                    ))}
                </div>
            );
        };

        const App = () => {
            // State
            const [inputStr, setInputStr] = useState("4, 2, 1, 7, 8, 1, 2, 8, 1, 0");
            const [k, setK] = useState(3);
            const [nums, setNums] = useState([]);
            const [trace, setTrace] = useState([]);
            const [step, setStep] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [speed, setSpeed] = useState(1000);

            // Initialize
            useEffect(() => {
                handleReset();
            }, []); // Run once on mount

            // Effect for parsing input and generating trace
            const handleReset = () => {
                setIsPlaying(false);
                setStep(0);
                const parsed = inputStr.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
                if (parsed.length === 0) return;
                setNums(parsed);
                setTrace(generateTrace(parsed, k));
            };

            // Effect for Auto-Play
            useEffect(() => {
                let interval;
                if (isPlaying && step < trace.length - 1) {
                    interval = setInterval(() => {
                        setStep(s => s + 1);
                    }, speed);
                } else if (step >= trace.length - 1) {
                    setIsPlaying(false);
                }
                return () => clearInterval(interval);
            }, [isPlaying, step, trace.length, speed]);

            const safeStep = Math.min(step, trace.length - 1);
            const currentFrame = trace[safeStep] || trace[0];

            // Handlers
            const handleNext = () => setStep(s => Math.min(s + 1, trace.length - 1));
            const handlePrev = () => setStep(s => Math.max(s - 1, 0));

            return (
                <div className={`min-h-screen ${THEME.bg} p-4 md:p-8 font-sans text-gray-800`}>
                    <div className="max-w-5xl mx-auto space-y-6">

                        {/* Header */}
                        <header className="text-center text-white drop-shadow-md">
                            <h1 className="text-4xl md:text-5xl font-extrabold tracking-tight flex items-center justify-center gap-3">
                                <Zap className="text-yellow-300 w-10 h-10" fill="#fde047" />
                                Poké-Sum Slider
                                <Zap className="text-yellow-300 w-10 h-10" fill="#fde047" />
                            </h1>
                            <p className="mt-2 text-green-100 font-medium text-lg">Master the Sliding Window Technique!</p>
                        </header>

                        {/* Input Control Panel */}
                        <div className={`
              ${THEME.card} p-4 rounded-2xl shadow-xl border-b-4 border-green-700
            `}>
                            <div className="flex flex-col md:flex-row gap-4 items-end">
                                <div className="flex-1 w-full">
                                    <label className="block text-sm font-bold text-gray-600 mb-1">Power Levels (Comma separated)</label>
                                    <input
                                        type="text"
                                        value={inputStr}
                                        onChange={(e) => setInputStr(e.target.value)}
                                        className="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none font-mono"
                                    />
                                </div>
                                <div className="w-24">
                                    <label className="block text-sm font-bold text-gray-600 mb-1">Window (k)</label>
                                    <input
                                        type="number"
                                        min="1"
                                        max={nums.length}
                                        value={k}
                                        onChange={(e) => setK(parseInt(e.target.value))}
                                        className="w-full p-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none font-mono"
                                    />
                                </div>
                                <button
                                    onClick={handleReset}
                                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2"
                                >
                                    <RotateCcw size={18} /> Load Data
                                </button>
                            </div>
                        </div>

                        {/* Visualization Arena */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">

                            {/* Main Visualizer (Left 2/3) */}
                            <div className="lg:col-span-2 space-y-6">

                                {/* The Array Display */}
                                <div className={`
                  ${THEME.card} p-8 rounded-3xl shadow-2xl min-h-[300px] flex flex-col justify-center items-center relative overflow-hidden
                `}>
                                    {/* Background Decoration */}
                                    <div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]"></div>

                                    {/* Message Box */}
                                    <div className="absolute top-4 left-4 right-4 bg-yellow-100 border-l-4 border-yellow-500 p-3 text-sm md:text-base text-yellow-800 font-medium rounded shadow-sm flex items-start gap-3">
                                        <Info className="w-5 h-5 shrink-0 mt-0.5" />
                                        {currentFrame?.message}
                                    </div>

                                    {/* Elements Container */}
                                    <div className="flex flex-wrap justify-center items-center gap-4 mt-12 w-full">
                                        {nums.map((num, idx) => (
                                            <Pokeball
                                                key={idx}
                                                value={num}
                                                index={idx}
                                                state={currentFrame || {}}
                                                k={k}
                                                total={nums.length}
                                            />
                                        ))}
                                    </div>

                                    {/* Window Indicator Logic Visualized */}
                                    {currentFrame?.windowRange && (
                                        <div className="mt-8 text-sm font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2">
                                            <div className="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                                            Active Window: Indices [{currentFrame.windowRange[0]} - {currentFrame.windowRange[1]}]
                                        </div>
                                    )}
                                </div>

                                {/* Playback Controls */}
                                <div className={`
                  ${THEME.card} p-4 rounded-xl shadow-lg flex flex-wrap justify-center gap-4 items-center
                `}>
                                    <button onClick={() => setStep(0)} className="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors" title="Start">
                                        <SkipBack size={24} />
                                    </button>
                                    <button onClick={handlePrev} className="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors" title="Previous Step">
                                        <RotateCcw size={20} className="scale-x-[-1]" />
                                    </button>
                                    <button
                                        onClick={() => setIsPlaying(!isPlaying)}
                                        className={`
                      w-14 h-14 flex items-center justify-center rounded-full text-white shadow-lg transform transition-transform hover:scale-105 active:scale-95
                      ${isPlaying ? 'bg-red-500' : 'bg-green-500'}
                    `}
                                    >
                                        {isPlaying ? <Pause fill="currentColor" /> : <Play fill="currentColor" className="ml-1" />}
                                    </button>
                                    <button onClick={handleNext} className="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors" title="Next Step">
                                        <RotateCcw size={20} />
                                    </button>
                                    <button onClick={() => setStep(trace.length - 1)} className="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors" title="End">
                                        <SkipForward size={24} />
                                    </button>

                                    <div className="w-px h-8 bg-gray-300 mx-2 hidden sm:block"></div>

                                    <div className="flex items-center gap-2">
                                        <span className="text-xs font-bold text-gray-500">Speed</span>
                                        <input
                                            type="range"
                                            min="100"
                                            max="2000"
                                            step="100"
                                            value={2100 - speed}
                                            onChange={(e) => setSpeed(2100 - parseInt(e.target.value))}
                                            className="w-24 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar (Right 1/3) */}
                            <div className="space-y-6">

                                {/* Stats Panel */}
                                <div className={`
                  ${THEME.card} p-6 rounded-2xl shadow-xl border-t-8 border-blue-500 flex flex-col gap-6
                `}>
                                    <h2 className="text-xl font-bold text-gray-700 flex items-center gap-2">
                                        <Calculator size={20} /> Battle Stats
                                    </h2>

                                    {/* Current Window Sum */}
                                    <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                        <span className="text-sm font-semibold text-blue-500 uppercase tracking-wider">Current Window Sum</span>
                                        <div className="flex items-end justify-between mt-1">
                                            <span className="text-4xl font-black text-blue-700">{currentFrame?.windowSum !== undefined ? currentFrame.windowSum : '-'}</span>
                                            <span className="text-xs text-blue-400 mb-1">Accumulating...</span>
                                        </div>
                                    </div>

                                    {/* Max Sum Record */}
                                    <div className="bg-yellow-50 p-4 rounded-xl border border-yellow-100 relative overflow-hidden">
                                        <Trophy className="absolute -right-4 -bottom-4 w-24 h-24 text-yellow-500/10 rotate-12" />
                                        <span className="text-sm font-semibold text-yellow-600 uppercase tracking-wider flex items-center gap-1">
                                            <Trophy size={14} /> Record Max Sum
                                        </span>
                                        <div className="flex items-end justify-between mt-1 relative z-10">
                                            <span className="text-4xl font-black text-yellow-700">
                                                {currentFrame?.maxSum === -Infinity ? '0' : currentFrame?.maxSum}
                                            </span>
                                            {currentFrame?.highlightType === 'record' && (
                                                <span className="px-2 py-1 bg-yellow-500 text-white text-xs font-bold rounded animate-pulse">
                                                    NEW RECORD!
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Code Walkthrough */}
                                <div className="flex flex-col gap-2">
                                    <h2 className="text-sm font-bold text-white/80 uppercase tracking-wide ml-1">Training Log (Code)</h2>
                                    <CodeBlock activeLine={currentFrame?.codeLine} />
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>