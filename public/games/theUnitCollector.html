<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Unit Collector - Power Up!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Outfit:wght@400;900&display=swap');

        :root {
            --neon-green: #00ff88;
            --power-bg: #0a0e14;
            --panel-border: #1a2433;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--power-bg);
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }

        .hero-font {
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
        }

        .power-cell {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            stroke-width: 4;
            stroke: #1a2433;
        }

        .power-cell:hover {
            filter: brightness(1.3);
        }

        .cell-active {
            fill: var(--neon-green) !important;
            filter: drop-shadow(0 0 12px var(--neon-green));
            stroke: white;
        }

        .snap-flash {
            animation: flash 0.4s ease-out;
        }

        @keyframes flash {
            0% {
                background-color: rgba(0, 255, 136, 0.4);
            }

            100% {
                background-color: transparent;
            }
        }

        .shake-ui {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-8px);
            }

            40% {
                transform: translateX(8px);
            }

            60% {
                transform: translateX(-4px);
            }

            80% {
                transform: translateX(4px);
            }
        }

        /* Glassmorphism for the UI */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
        }

        .fraction-display {
            font-size: 5rem;
            line-height: 1;
        }

        .fraction-line {
            width: 80px;
            height: 8px;
            background: white;
            margin: 4px 0;
            border-radius: 4px;
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- Top Status Bar -->
    <div class="w-full max-w-lg flex justify-between items-center mb-6 px-4">
        <div class="glass-panel px-4 py-2">
            <p class="text-[10px] font-black uppercase text-slate-500">System Link</p>
            <p class="text-xs font-bold text-green-400">STREAK: <span id="streak-val">0</span>/8</p>
        </div>
        <h1 class="hero-font text-xl italic text-white">UNIT COLLECTOR</h1>
        <div class="glass-panel px-4 py-2 text-right">
            <p class="text-[10px] font-black uppercase text-slate-500">Auto-Snap</p>
            <p id="snap-status" class="text-xs font-bold text-blue-400">ACTIVE</p>
        </div>
    </div>

    <!-- Main Game Board -->
    <div id="game-board" class="glass-panel w-full max-w-md p-8 flex flex-col items-center space-y-10 relative">

        <!-- Objective Display -->
        <div class="flex items-center gap-8">
            <div class="text-center">
                <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Target Charge</p>
                <div class="flex flex-col items-center">
                    <span id="target-num" class="hero-font fraction-display text-green-400">3</span>
                    <div class="fraction-line"></div>
                    <span id="target-den" class="hero-font fraction-display text-white">4</span>
                </div>
            </div>

            <div class="h-24 w-[2px] bg-slate-800"></div>

            <div class="text-left">
                <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Instructions</p>
                <p id="instruction-text" class="text-sm font-bold text-slate-300 leading-tight">
                    Tap the energy cells to fill <span class="text-green-400">exactly</span> three quarters.
                </p>
            </div>
        </div>

        <!-- The Energy Cell Shape -->
        <div id="shape-container" class="relative w-64 h-64 flex items-center justify-center">
            <!-- SVG Shape Injected Here -->
        </div>

        <!-- Action Button -->
        <button id="charge-btn"
            class="w-full py-5 rounded-2xl bg-green-500 text-black hero-font text-2xl hover:bg-green-400 active:scale-95 transition-all shadow-[0_0_20px_rgba(0,255,136,0.3)]">
            ENGAGE POWER!
        </button>
    </div>

    <script>
        const shapeContainer = document.getElementById('shape-container');
        const targetNumEl = document.getElementById('target-num');
        const targetDenEl = document.getElementById('target-den');
        const chargeBtn = document.getElementById('charge-btn');
        const streakValEl = document.getElementById('streak-val');
        const instructionText = document.getElementById('instruction-text');
        const gameBoard = document.getElementById('game-board');

        let currentNum = 3;
        let currentDen = 4;
        let selectedIndices = new Set();
        let streak = 0;
        let isProcessing = false;

        function initLevel() {
            isProcessing = false;
            // Randomly choose denominator (2-8) and numerator (1 to den-1)
            currentDen = Math.floor(Math.random() * 7) + 2;
            currentNum = Math.floor(Math.random() * (currentDen - 1)) + 1;

            targetNumEl.innerText = currentNum;
            targetDenEl.innerText = currentDen;
            selectedIndices.clear();

            renderShape();

            instructionText.innerHTML = `Tap the energy cells to fill <span class="text-green-400">exactly</span> ${currentNum} out of ${currentDen} parts.`;
            chargeBtn.innerText = "ENGAGE POWER!";
            chargeBtn.classList.remove('bg-red-500', 'bg-blue-500');
            chargeBtn.classList.add('bg-green-500');
        }

        function renderShape() {
            const size = 250;
            const center = size / 2;
            const radius = 100;
            let svgContent = '';

            // 50% chance of circle or bar
            const type = Math.random() > 0.5 ? 'circle' : 'bar';

            if (type === 'circle') {
                for (let i = 0; i < currentDen; i++) {
                    const angleStep = (2 * Math.PI) / currentDen;
                    const startAngle = i * angleStep - Math.PI / 2;
                    const endAngle = (i + 1) * angleStep - Math.PI / 2;

                    const x1 = center + radius * Math.cos(startAngle);
                    const y1 = center + radius * Math.sin(startAngle);
                    const x2 = center + radius * Math.cos(endAngle);
                    const y2 = center + radius * Math.sin(endAngle);

                    const largeArcFlag = angleStep > Math.PI ? 1 : 0;

                    const pathData = `M ${center} ${center} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;

                    svgContent += `<path d="${pathData}" class="power-cell" data-index="${i}" fill="#1a2433" />`;
                }
            } else {
                const barWidth = 220;
                const barHeight = 80;
                const startX = (size - barWidth) / 2;
                const startY = (size - barHeight) / 2;
                const partWidth = barWidth / currentDen;

                for (let i = 0; i < currentDen; i++) {
                    svgContent += `<rect x="${startX + i * partWidth}" y="${startY}" width="${partWidth}" height="${barHeight}" class="power-cell" data-index="${i}" fill="#1a2433" />`;
                }
            }

            shapeContainer.innerHTML = `<svg viewBox="0 0 ${size} ${size}" class="w-full h-full">${svgContent}</svg>`;

            // Add click events to cells
            document.querySelectorAll('.power-cell').forEach(cell => {
                cell.addEventListener('click', () => toggleCell(cell));
            });
        }

        function toggleCell(cell) {
            if (isProcessing) return;
            const idx = parseInt(cell.getAttribute('data-index'));

            if (selectedIndices.has(idx)) {
                selectedIndices.delete(idx);
                cell.classList.remove('cell-active');
            } else {
                selectedIndices.add(idx);
                cell.classList.add('cell-active');

                // AUTO-PRECISION (Magnetic Snapping Logic)
                // If the user clicks the final piece needed, play a "snap" visual effect
                if (selectedIndices.size === currentNum) {
                    gameBoard.classList.add('snap-flash');
                    setTimeout(() => gameBoard.classList.remove('snap-flash'), 400);
                }
            }
        }

        function verify() {
            if (isProcessing) return;
            isProcessing = true;

            const isCorrect = selectedIndices.size === currentNum;

            if (isCorrect) {
                streak++;
                streakValEl.innerText = streak;
                chargeBtn.innerText = "POWER STABLE!";
                chargeBtn.classList.replace('bg-green-500', 'bg-blue-500');

                if (streak >= 8) {
                    win();
                } else {
                    setTimeout(initLevel, 1000);
                }
            } else {
                streak = 0;
                streakValEl.innerText = streak;
                gameBoard.classList.add('shake-ui');
                chargeBtn.innerText = "ERROR: WRONG CHARGE";
                chargeBtn.classList.replace('bg-green-500', 'bg-red-500');

                setTimeout(() => {
                    gameBoard.classList.remove('shake-ui');
                    isProcessing = false;
                    chargeBtn.innerText = "TRY AGAIN";
                    chargeBtn.classList.replace('bg-red-500', 'bg-green-500');
                }, 1000);
            }
        }

        function win() {
            shapeContainer.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-4 animate-bounce">âš¡</div>
                    <h2 class="hero-font text-2xl text-green-400">GRID STABILIZED!</h2>
                    <p class="text-sm font-bold text-slate-400 mt-2">Numerator Mastery Unlocked.</p>
                    <button onclick="location.reload()" class="mt-6 bg-white text-black px-6 py-2 rounded-full font-black text-xs uppercase">Restart System</button>
                </div>
            `;
            instructionText.innerText = "All sectors powered. Move to Number Line Hopper?";
        }

        chargeBtn.addEventListener('click', verify);
        window.onload = initLevel;
    </script>
</body>

</html>