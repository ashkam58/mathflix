<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Fraction Match - Plumber Tech Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Share+Tech+Mono&display=swap');

        :root {
            --omnitrix-green: #00ff00;
            --phantom-purple: #a855f7;
            --tech-bg: #050505;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--tech-bg);
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }

        .omni-font {
            font-family: 'Orbitron', sans-serif;
        }

        .ghost-container {
            filter: drop-shadow(0 0 15px var(--phantom-purple));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(2deg);
            }
        }

        .capture-flash {
            animation: flash-green 0.5s ease-out forwards;
        }

        @keyframes flash-green {
            0% {
                box-shadow: inset 0 0 100px var(--omnitrix-green);
            }

            100% {
                box-shadow: inset 0 0 0px transparent;
            }
        }

        .tech-input {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #004400;
            color: var(--omnitrix-green);
            text-align: center;
            font-size: 2.5rem;
            width: 80px;
            border-radius: 12px;
            outline: none;
            transition: all 0.2s;
        }

        .tech-input:focus {
            border-color: var(--omnitrix-green);
            background: rgba(0, 255, 0, 0.15);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .tech-line {
            width: 80px;
            height: 6px;
            background: var(--omnitrix-green);
            margin: 8px 0;
            box-shadow: 0 0 10px var(--omnitrix-green);
        }

        .timer-bar {
            height: 10px;
            background: #111;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #333;
        }

        #time-fill {
            height: 100%;
            background: linear-gradient(to right, #00ff00, #ff0000);
            width: 100%;
            transition: width 0.1s linear;
        }

        .shake {
            animation: shake-ui 0.3s ease-in-out;
        }

        @keyframes shake-ui {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- PLUMBER INTERFACE HEADER -->
    <div class="w-full max-w-lg mb-8 flex items-center justify-between border-b border-green-900/50 pb-4">
        <div>
            <p class="text-[10px] text-green-500/50 tracking-[0.2em]">IDENTIFY ANOMALY</p>
            <h1 class="omni-font text-xl text-green-400">PHANTOM SCANNER</h1>
        </div>
        <div class="text-right">
            <p class="text-[10px] text-green-500/50 tracking-[0.2em]">STREAK</p>
            <p id="streak-count" class="omni-font text-2xl text-green-400">0</p>
        </div>
    </div>

    <!-- MAIN SCANNER AREA -->
    <div id="scanner-frame"
        class="relative w-full max-w-md aspect-square rounded-[3rem] bg-zinc-900 border-[10px] border-zinc-800 shadow-[0_0_50px_rgba(0,0,0,1)] flex flex-col items-center justify-center overflow-hidden">

        <!-- Timer UI -->
        <div class="absolute top-10 w-3/4">
            <div class="flex justify-between text-[10px] mb-1 text-green-500/50">
                <span>STABILIZING LINK...</span>
                <span id="timer-text">100%</span>
            </div>
            <div class="timer-bar">
                <div id="time-fill"></div>
            </div>
        </div>

        <!-- The Ghostly Fraction -->
        <div id="ghost-stage" class="ghost-container w-64 h-64 flex items-center justify-center">
            <!-- SVG Ghost Shape Injected Here -->
        </div>

        <!-- Target Lock Reticle -->
        <div class="absolute inset-0 pointer-events-none opacity-20">
            <div class="absolute top-10 left-10 w-10 h-10 border-t-4 border-l-4 border-green-500"></div>
            <div class="absolute top-10 right-10 w-10 h-10 border-t-4 border-r-4 border-green-500"></div>
            <div class="absolute bottom-10 left-10 w-10 h-10 border-b-4 border-l-4 border-green-500"></div>
            <div class="absolute bottom-10 right-10 w-10 h-10 border-b-4 border-r-4 border-green-500"></div>
        </div>
    </div>

    <!-- DATA INPUT TERMINAL -->
    <div class="mt-8 flex flex-col items-center gap-4">
        <div class="flex flex-col items-center">
            <input type="number" id="input-num" class="tech-input omni-font" placeholder="?" autocomplete="off">
            <div class="tech-line"></div>
            <input type="number" id="input-den" class="tech-input omni-font" placeholder="?" autocomplete="off">
        </div>
        <p class="text-xs text-green-500/50 animate-pulse">TYPE FRACTION TO CAPTURE</p>
    </div>

    <script>
        const ghostStage = document.getElementById('ghost-stage');
        const inputNum = document.getElementById('input-num');
        const inputDen = document.getElementById('input-den');
        const streakEl = document.getElementById('streak-count');
        const scannerFrame = document.getElementById('scanner-frame');
        const timeFill = document.getElementById('time-fill');
        const timerText = document.getElementById('timer-text');

        let currentProblem = { n: 0, d: 0 };
        let streak = 0;
        let timeLeft = 100;
        let timerInterval;

        function initGame() {
            // Random Denominator 2-8
            const d = Math.floor(Math.random() * 7) + 2;
            // Random Numerator 1 to d
            const n = Math.floor(Math.random() * d) + 1;

            currentProblem = { n, d };
            renderGhost(n, d);

            inputNum.value = '';
            inputDen.value = '';
            inputNum.focus();

            resetTimer();
        }

        function renderGhost(n, d) {
            const size = 200;
            const center = size / 2;
            const radius = 80;
            let svg = `<svg viewBox="0 0 ${size} ${size}" class="w-full h-full">`;

            // Random shape type: 0=Circle, 1=Rect
            const isCircle = Math.random() > 0.5;

            if (isCircle) {
                // Background shadow circle
                svg += `<circle cx="${center}" cy="${center}" r="${radius}" fill="rgba(168, 85, 247, 0.1)" stroke="rgba(168, 85, 247, 0.4)" stroke-width="2" />`;

                for (let i = 0; i < d; i++) {
                    const angleStep = (2 * Math.PI) / d;
                    const startA = i * angleStep - Math.PI / 2;
                    const endA = (i + 1) * angleStep - Math.PI / 2;

                    const x1 = center + radius * Math.cos(startA);
                    const y1 = center + radius * Math.sin(startA);
                    const x2 = center + radius * Math.cos(endA);
                    const y2 = center + radius * Math.sin(endA);

                    const isShaded = i < n;
                    const color = isShaded ? 'rgba(168, 85, 247, 0.8)' : 'transparent';

                    svg += `<path d="M ${center} ${center} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z" fill="${color}" stroke="rgba(255,255,255,0.2)" stroke-width="1" />`;
                }
            } else {
                const w = 160;
                const h = 60;
                const startX = center - w / 2;
                const startY = center - h / 2;
                const partW = w / d;

                svg += `<rect x="${startX}" y="${startY}" width="${w}" height="${h}" fill="rgba(168, 85, 247, 0.1)" stroke="rgba(168, 85, 247, 0.4)" stroke-width="2" />`;

                for (let i = 0; i < d; i++) {
                    const isShaded = i < n;
                    const color = isShaded ? 'rgba(168, 85, 247, 0.8)' : 'transparent';
                    svg += `<rect x="${startX + i * partW}" y="${startY}" width="${partW}" height="${h}" fill="${color}" stroke="rgba(255,255,255,0.2)" stroke-width="1" />`;
                }
            }

            svg += `</svg>`;
            ghostStage.innerHTML = svg;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timeLeft = 100;
            // Speed up timer as streak increases
            const speed = Math.max(20, 100 - (streak * 5));

            timerInterval = setInterval(() => {
                timeLeft -= 1;
                timeFill.style.width = timeLeft + '%';
                timerText.innerText = timeLeft + '%';

                if (timeLeft <= 0) {
                    fail();
                }
            }, speed);
        }

        function checkAnswer() {
            const userN = parseInt(inputNum.value);
            const userD = parseInt(inputDen.value);

            if (userN === currentProblem.n && userD === currentProblem.d) {
                success();
            } else if (inputNum.value.length >= 1 && inputDen.value.length >= 1) {
                // If both are filled but wrong, and user keeps typing, we wait or shake
                if (userD > 0 && userD >= userN) {
                    // Could be a typo, wait a bit
                }
            }
        }

        function success() {
            clearInterval(timerInterval);
            streak++;
            streakEl.innerText = streak;

            scannerFrame.classList.add('capture-flash');
            ghostStage.style.transform = 'scale(0) rotate(180deg)';
            ghostStage.style.opacity = '0';

            setTimeout(() => {
                scannerFrame.classList.remove('capture-flash');
                ghostStage.style.transform = '';
                ghostStage.style.opacity = '1';
                initGame();
            }, 500);
        }

        function fail() {
            clearInterval(timerInterval);
            streak = 0;
            streakEl.innerText = streak;
            scannerFrame.classList.add('shake');

            // Show correct answer briefly
            inputNum.value = currentProblem.n;
            inputDen.value = currentProblem.d;
            inputNum.style.color = '#ff0000';
            inputDen.style.color = '#ff0000';

            setTimeout(() => {
                scannerFrame.classList.remove('shake');
                inputNum.style.color = '';
                inputDen.style.color = '';
                initGame();
            }, 1500);
        }

        // Auto-check on input
        [inputNum, inputDen].forEach(el => {
            el.addEventListener('input', checkAnswer);
        });

        // Start game
        window.onload = initGame;
    </script>
</body>

</html>